<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical X-ray Classifier with Grad-CAM</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ©»</text></svg>">
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Analyzing X-ray Image with Grad-CAM...</div>
    </div>

    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-stethoscope"></i>
                    </div>
                    <div class="logo-text">
                        <h1>Medical X-ray Classifier with Grad-CAM</h1>
                        <p>AI-powered chest X-ray analysis with heatmap visualization</p>
                    </div>
                </div>
                <div class="health-status">
                    <a href="/health" class="btn btn-secondary" target="_blank">
                        <i class="fas fa-heartbeat btn-icon"></i>
                        System Health
                    </a>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Upload Section -->
        <section class="upload-section">
            <h2 class="section-title">
                <i class="fas fa-upload"></i> Upload X-ray Image
            </h2>
            
            <div class="alert" id="alertBox"></div>
            
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">
                    <i class="fas fa-cloud-upload-alt"></i>
                </div>
                <div class="upload-text">
                    <h3>Drag & Drop X-ray Image</h3>
                    <p>or click to browse files</p>
                    <p class="file-types">Supported formats: JPG, PNG, BMP, GIF (Max 10MB)</p>
                </div>
            </div>
            
            <input type="file" class="file-input" id="fileInput" accept="image/*">
            
            <div class="file-info" id="fileInfo">
                <div class="file-name" id="fileName"></div>
                <img src="" alt="Preview" class="file-preview" id="filePreview">
            </div>
            
            <div class="button-group">
                <button class="btn btn-primary" id="analyzeBtn" disabled>
                    <i class="fas fa-search btn-icon"></i>
                    Analyze X-ray with Grad-CAM
                </button>
                <button class="btn btn-secondary" id="clearBtn">
                    <i class="fas fa-times btn-icon"></i>
                    Clear
                </button>
            </div>
            
            <!-- Color Legend Section -->
            <div class="color-legend">
                <h3><i class="fas fa-palette"></i> Understanding the Results</h3>
                <div class="legend-items">
                    <div class="legend-item">
                        <div class="legend-color-box confidence-high"></div>
                        <div class="legend-text">
                            <strong>High Confidence (â‰¥80%)</strong>: AI is very certain about its prediction
                        </div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color-box confidence-medium"></div>
                        <div class="legend-text">
                            <strong>Medium Confidence (60-79%)</strong>: AI is moderately certain
                        </div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color-box confidence-low"></div>
                        <div class="legend-text">
                            <strong>Low Confidence (<60%)</strong>: AI is uncertain - clinical review advised
                        </div>
                    </div>
                </div>
                
                <div class="legend-items">
                    <div class="legend-item">
                        <div class="legend-color-box risk-very-low"></div>
                        <div class="legend-text">
                            <strong>VERY LOW Risk</strong>: Normal finding with high confidence
                        </div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color-box risk-moderate"></div>
                        <div class="legend-text">
                            <strong>MODERATE Risk</strong>: Either uncertain normal or confident pneumonia
                        </div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color-box risk-high"></div>
                        <div class="legend-text">
                            <strong>HIGH Risk</strong>: Uncertain pneumonia finding
                        </div>
                    </div>
                </div>
                
                <div class="legend-note">
                    <p><i class="fas fa-info-circle"></i> <strong>Note:</strong> Percentages show AI confidence, not clinical probability. Red areas in heatmaps show where the AI focused.</p>
                </div>
            </div>
            
            <div class="instructions">
                <h3><i class="fas fa-info-circle"></i> How to use:</h3>
                <ol>
                    <li>Upload a chest X-ray image (AP or PA view recommended)</li>
                    <li>Click "Analyze X-ray with Grad-CAM" to process the image</li>
                    <li>Review the analysis results and heatmap visualization</li>
                    <li>Red areas in heatmap show regions important for diagnosis</li>
                    <li>For clinical diagnosis, always consult with a medical professional</li>
                </ol>
            </div>
        </section>

        <!-- Results Section -->
        <section class="results-section">
            <h2 class="section-title">
                <i class="fas fa-chart-line"></i> Analysis Results
            </h2>
            
            <div class="results-placeholder" id="resultsPlaceholder">
                <div class="placeholder-icon">
                    <i class="fas fa-clipboard-list"></i>
                </div>
                <h3>No Analysis Yet</h3>
                <p>Upload an X-ray image and click "Analyze" to see results here.</p>
            </div>
            
            <div class="results-content" id="resultsContent">
                <!-- Diagnosis Results -->
                <div class="result-card" id="binaryCard">
                    <div class="result-header">
                        <div class="result-title">Pneumonia Detection</div>
                        <div class="result-confidence" id="binaryConfidence">0%</div>
                    </div>
                    <div class="result-prediction">
                        <h3 id="binaryPrediction">--</h3>
                    </div>
                    <div class="confidence-value" id="binaryConfidenceValue">0%</div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="binaryConfidenceFill" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- Subtype Results -->
                <div class="result-card" id="subtypeCard" style="display: none;">
                    <div class="result-header">
                        <div class="result-title">Pneumonia Subtype</div>
                        <div class="result-confidence" id="subtypeConfidence">0%</div>
                    </div>
                    <div class="result-prediction">
                        <h3 id="subtypePrediction">--</h3>
                    </div>
                    <div class="confidence-value" id="subtypeConfidenceValue">0%</div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="subtypeConfidenceFill" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- Risk Level Results -->
                <div class="result-card" id="riskCard" style="display: none;">
                    <div class="result-header">
                        <div class="result-title">AI Confidence Risk Level</div>
                        <div class="result-risk-badge" id="riskBadge">--</div>
                    </div>
                    <div class="result-prediction">
                        <h3 id="riskLevel">--</h3>
                    </div>
                    <div class="confidence-value" id="finalConfidenceValue">0%</div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="finalConfidenceFill" style="width: 0%"></div>
                    </div>
                    <div class="risk-explanation">
                        <p><i class="fas fa-info-circle"></i> <strong>Note:</strong> This is an AI confidence indicator, NOT a clinical risk score</p>
                        <p><i class="fas fa-exclamation-triangle"></i> Lower confidence = Higher AI uncertainty = Clinical correlation strongly advised</p>
                    </div>
                </div>
                
                <!-- Heatmap Visualization -->
                <div class="result-card" id="heatmapContainer" style="display: none;">
                    <div class="result-header">
                        <div class="result-title">Grad-CAM Heatmap</div>
                        <div class="result-title">AI Attention Visualization</div>
                    </div>
                    <div class="heatmap-explanation">
                        <p><i class="fas fa-fire"></i> <strong>Red areas</strong> indicate regions the AI focuses on for diagnosis</p>
                        <p><i class="fas fa-info-circle"></i> Heatmap shows which parts of the X-ray influenced the prediction</p>
                    </div>
                    <img src="" alt="Grad-CAM Heatmap" class="result-image" id="heatmapImage" style="display: none;">
                </div>
                
                <!-- Original Image -->
                <div class="uploaded-image-container">
                    <h3><i class="fas fa-image"></i> Analyzed Image</h3>
                    <img src="" alt="Uploaded X-ray" class="result-image" id="uploadedImage">
                </div>
                
                <!-- Medical Analysis -->
                <div class="result-card" id="medicalAnalysisCard" style="display: none;">
                    <div class="result-header">
                        <div class="result-title">Medical Pattern Analysis</div>
                    </div>
                    <pre class="medical-analysis" id="medicalAnalysis" style="white-space: pre-wrap; font-family: inherit; padding: 10px; background: #f8f9fa; border-radius: 5px;"></pre>
                </div>
                
                <div class="result-timestamp" id="resultTimestamp"></div>
            </div>
            
            <div class="disclaimer">
                <h3><i class="fas fa-exclamation-triangle"></i> Important Disclaimer</h3>
                <p>This tool is for educational and research purposes only. It is not a substitute for professional medical advice, diagnosis, or treatment. Always seek the advice of a qualified healthcare provider with any questions you may have regarding a medical condition.</p>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>Medical X-ray Classifier with Grad-CAM v2.0 | For educational and research purposes only</p>
            <p>Always consult with a healthcare professional for medical diagnosis</p>
        </div>
    </footer>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>